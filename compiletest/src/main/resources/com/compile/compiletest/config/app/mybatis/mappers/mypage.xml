<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mypage">
	
	<update id="changeNickname" parameterType="string">
		<![CDATA[
			update user 
   			   set nickname = #{nickname }
 			 where no = 1
		]]>
	</update>
	
	<update id="changePassword" parameterType="string">
		<![CDATA[
			update user 
   			   set password = #{password }
 			 where no = 1
		]]>
	</update>
	
	<update id="foreignKeyChecks" parameterType="long">
		<![CDATA[
			set foreign_key_checks = #{num }
		]]>
	</update>
	
	<delete id="deleteUser" parameterType="string">
		<![CDATA[
			delete
  			  from user
 			 where no = 1
		]]>
	</delete>
	
	<select id="lookUpPassword" parameterType="string" resultType="string">
		<![CDATA[
			select password
  			  from user
			 where email = #{email }
		]]>
	</select>
	
	<select id="selectProblemList" parameterType="map"  resultType="problemvo">
		<![CDATA[
			select p.no as no, p.title as title, p.hit as hit, p.recommend as recommend
			  from problem p, user u
			 where u.no = 1
			   limit #{displayPost}, #{postNum}
		]]>
	</select>
	
	<update id="deleteProblem" parameterType="long">
		<![CDATA[
			update problem
			   set state = 'n'
			 where no = #{no }
		]]>
	</update>
	
	<select id="problemSolveList" parameterType="long" resultType="submitVo">
		<![CDATA[
			select u.email as email, u.name as name, u.nickname as nickname, s.try_count as tryCount, s.lang as lang, s.solve_time as solveTime 
			from submit s, user u, problem p, sub_problem sp
			where u.no = s.user_no && p.no = sp.problem_no && s.problem_no = sp.no && p.no = #{no }
			group by u.email
		]]>
	</select>


	<select id="totalCount" resultType="integer">
		<![CDATA[
			select
				count(*) 
			from 
				problem p, user u 
			where 
				p.user_no = u.no and u.no = 1
		]]>
	</select>
	
	

</mapper>