<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="training">
	
	<select id="selectProblemListOrigin" resultType="problemvo">
		<![CDATA[
			  select p.no as no, p.title as title, k.name as kind, u.nickname as nickname, p.hit as hit, p.recommend as recommend, p.level_no as level 
			    from problem p, user u, kind k 
			   where p.user_no = u.no
				 and p.kind_no = k.no
			order by p.reg_date desc
		]]>
	</select>	
	
	<select id="selectLevelList" parameterType="hashmap" resultType="problemvo">
		<![CDATA[
			select p.no as no, p.title as title, k.name as kind, u.nickname as nickname, p.hit as hit, p.recommend as recommend, p.level_no as level 
			from problem p, user u, kind k 
			where p.user_no = u.no
				and p.user_no = 10000
				and p.kind_no = k.no
                and p.kind_no = 6
		]]>
		
		<if test="size != 0">
			<![CDATA[
				and	(
			]]>
		
		<if test="one != null">
			<![CDATA[
			    p.level_no = 1 or 
			]]>
		</if>
		<if test="two != null">
			<![CDATA[
			    p.level_no = 2 or 
			]]>
		</if>
		<if test="three != null">
			<![CDATA[
			    p.level_no = 3 or 
			]]>
		</if>
		<if test="four != null">
			<![CDATA[
			    p.level_no = 4 or 
			]]>
		</if>
		<if test="five != null">
			<![CDATA[
			    p.level_no = 5 or 
			]]>
		</if>
		<![CDATA[
		 0=1)
		]]>
		</if>
<!-- 		<![CDATA[ -->
<!-- 			    and k.no = 5 -->
<!-- 		]]> -->
	</select>
	
	
	<select id="selectOrganizationList" parameterType="hashmap" resultType="problemvo">
		<![CDATA[
			select p.no as no, p.title as title, k.name as kind, u.nickname as nickname, p.hit as hit, p.recommend as recommend, p.level_no as level
			  from problem p, user u, kind k
			 where p.user_no = u.no
			   and p.kind_no = k.no
			   and p.level_no = 6
		]]>
		
		<if test="size != 0">
			<![CDATA[
				and	(
			]]>
		
		<if test="enterprise != null">
			<![CDATA[
			    p.kind_no = 1 or 
			]]>
		</if>
		<if test="individual != null">
			<![CDATA[
			    p.kind_no = 2 or 
			]]>
		</if>
		<if test="academy != null">
			<![CDATA[
			    p.kind_no = 3 or 
			]]>
		</if>
		<if test="school != null">
			<![CDATA[
			    p.kind_no = 4 or 
			]]>
		</if>
		<if test="other != null">
			<![CDATA[
			    p.kind_no = 5 or 
			]]>
		</if>
		<![CDATA[
		 0=1)
		]]>
		</if>
<!-- 		<![CDATA[ -->
<!-- 			    and k.no = 5 -->
<!-- 		]]> -->
	</select>
	
	<insert id="insertProblem" parameterType="problemvo">
		<![CDATA[
			insert 
  			  into problem
			values (null, #{title }, null, 0, 0, now(), 1, #{kindNo }, null,null, 6, 'y')
		]]>
	</insert>
	
	<select id="selectProblemNo" resultType="long">
		<![CDATA[
			  select no
			    from problem 
			order by no desc limit 1
		]]>
	</select>
	
	<insert id="insertSubProblem" parameterType="hashmap">
		<![CDATA[
			insert 
			  into sub_problem 
			values
		]]>
		<foreach collection="subProblemList" item="item" separator=",">
		<![CDATA[
			 (null, "${item.title }", "${item.contents }", "${item.examInput }", "${item.correctCode}", "${item.examOutput }", ${problemNo },'y')
		]]>
		</foreach>
	</insert>
	
	
	<select id="selectProblemOne" parameterType="long" resultType="problemvo">
		<![CDATA[
			  select no, title, recommend
			    from problem
			   where no = #{no }
		]]>
	</select>
	
	<select id="selectSubProblem" parameterType="long" resultType="subproblemvo">
		<![CDATA[
			  select title, contents, exam_input as examInput, exam_output as examOutput, correct_code as correctCode
				from sub_problem 
			   where problem_no = #{no }
		]]>
	</select>
	
	
	
	<select id="totalCount" parameterType="string" resultType="integer">
		<choose>
			<when test="_parameter == null or _parameter == ''">
				<![CDATA[
					select count(*) from problem 
				]]>
			</when>
			<otherwise>
			 <![CDATA[
				 select count(*) from problem p,user u
				 where
				 	p.user_no = u.no and
				 	(title like '%${_parameter}%' or nickname like '%${_parameter}%')
			 ]]>
			</otherwise>			
		</choose>
	</select>	
	
	

	<select id="selectTrainingList" parameterType="map" resultType="problemvo">
		<choose>
			<when test="keyword == null or keyword == ''">
				<![CDATA[
					select 
						p.no as no, 
						p.title as title, 
						p.hit as hit, 
						p.recommend as recommend, 
						u.nickname
					  from problem p, user u
					 where 
					  	p.user_no = u.no
					   	and p.state = 'y'
					   	limit #{displayPost}, #{postNum}
				]]>			
			</when>
			<otherwise>
				<![CDATA[
					select 
						p.no as no, 
						p.title as title, 
						p.hit as hit, 
						p.recommend as recommend, 
						u.nickname
					  from problem p, user u
					 where 
					  	p.user_no = u.no
					  	and (title like '%${keyword}%' or nickname like '%${keyword}%')
					   	and p.state = 'y'
					   	limit #{displayPost}, #{postNum}
				]]>				
			</otherwise>
		</choose>

	</select>	
	
	
</mapper>